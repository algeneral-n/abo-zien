/**
 * RARE 4N - API Configuration
 * ?????????????? API - ???????? Development ?? Production
 */

const isDev = __DEV__;
const isProduction = !isDev;

/**
 * Development API (Local Network)
 * ???????????? IP address ?????????????? ?????????? ???? localhost
 * 
 * ???????????? ?????? IP address:
 * Windows: ipconfig (???????? ???? IPv4 Address)
 * Mac/Linux: ifconfig (???????? ???? inet)
 * 
 * ????????: 'http://192.168.1.100:5000/api'
 */
const DEV_API_LOCAL = 'http://192.168.1.100:5000/api'; // ?????? ???????? ?????? ?????? IP address ??????????????

/**
 * Development API (ngrok)
 * ???????????? ngrok ???????????? ?????? ???????? HTTPS
 * 
 * 1. ?????????? ngrok: npm install -g ngrok
 * 2. ??????????: ngrok http 5000
 * 3. ?????? ???????????? (??????: https://abc123.ngrok.io)
 * 4. ???????? ??????
 */
const DEV_API_NGROK = 'https://abc123.ngrok.io/api'; // ?????? ???????? ?????? ?????? ???????? ngrok

/**
 * Production API (Custom Domain)
 * ???????????? ???????????? ??????????
 * 
 * ??????????????: zien-ai.app
 * Subdomain ?????????? ??????: api.zien-ai.app
 */
const PROD_API = 'https://api.zien-ai.app/api'; // ??? ?????????????? ????????????

/**
 * API Base URL
 * 
 * Development: ???????????? ngrok (???? local network)
 * Production: ???????????? custom domain
 */
export const API_BASE = isProduction 
  ? PROD_API 
  : (process.env.EXPO_KEY=REPLACE_ME

/**
 * API Timeout (milliseconds)
 */
export const API_TIMEOUT = 30000; // 30 seconds

/**
 * API Retry Configuration
 */
export const API_RETRY = {
  maxRetries: 3,
  retryDelay: 1000, // 1 second
  retryableStatusCodes: [408, 429, 500, 502, 503, 504],
};

/**
 * Helper: Get API URL
 */
export function getApiUrl(endpoint: string): string {
  // Remove leading slash if present
  const cleanEndpoint = endpoint.startsWith('/') ? endpoint.slice(1) : endpoint;
  return `${API_BASE}/${cleanEndpoint}`;
}

/**
 * Helper: Check if API is reachable
 */
export async function checkApiHealth(): Promise<boolean> {
  try {
    const response = await fetch(`${API_BASE.replace('/api', '')}/health`, {
      method: 'GET',
      timeout: 5000,
    });
    return response.ok;
  } catch (error) {
    console.error('API Health Check failed:', error);
    return false;
  }
}

/**
 * Log current API configuration (Development only)
 */
if (isDev) {
  console.log('???? API Configuration:');
  console.log(`   Base URL: ${API_BASE}`);
  console.log(`   Environment: ${isProduction ? 'Production' : 'Development'}`);
  console.log(`   Timeout: ${API_TIMEOUT}ms`);
}



